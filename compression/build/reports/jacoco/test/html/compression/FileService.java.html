<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compression</a> &gt; <a href="index.source.html" class="el_package">compression</a> &gt; <span class="el_source">FileService.java</span></div><h1>FileService.java</h1><pre class="source lang-java linenums">/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package compression;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.util.NoSuchElementException;
import java.io.IOException;
import java.nio.ByteBuffer;
import java.lang.Integer;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.File;

/**
 *
 * @author tuomomehtala
 */
public class FileService {
    private BufferedInputStream ioIn;
    private BufferedOutputStream ioOut;
    private int buffer;
    private int index;
    private int outBuffer;
    private int outIndex;  
    private boolean active;
    private byte[] outBufferall;
    private int inCounter,outCounter;
    
    
<span class="fc" id="L34">    public FileService(BufferedInputStream in, BufferedOutputStream out){</span>
<span class="fc" id="L35">        this.ioIn = in;</span>
<span class="fc" id="L36">        this.ioOut = out;</span>
<span class="fc" id="L37">        this.index = 0;</span>
<span class="fc" id="L38">        this.buffer = 0;</span>
<span class="fc" id="L39">        this.outBuffer = 0;</span>
<span class="fc" id="L40">        this.active = true;</span>
<span class="fc" id="L41">        fillInBuffer();</span>
       
        
<span class="fc" id="L44">    }</span>
<span class="fc" id="L45">    public FileService(String inputFile,String outputFile) throws IOException{</span>
       
<span class="fc" id="L47">               ioIn = new BufferedInputStream(new FileInputStream(inputFile));</span>
<span class="fc" id="L48">              ioOut = new BufferedOutputStream(new FileOutputStream(outputFile));</span>
<span class="fc" id="L49">               this.index = 0;</span>
<span class="fc" id="L50">        this.buffer = 0;</span>
<span class="fc" id="L51">        this.outBuffer = 0;</span>
<span class="fc" id="L52">        this.active = true;</span>
<span class="fc" id="L53">        fillInBuffer();</span>
       
<span class="fc" id="L55">    }</span>
    public boolean inEmpty(){
<span class="fc bfc" id="L57" title="All 2 branches covered.">        return index == -1;</span>
    }
    private void fillInBuffer(){
<span class="pc bpc" id="L60" title="2 of 4 branches missed.">        if(buffer == 0 &amp;&amp; index &gt; -1){</span>
            try{
                
<span class="fc" id="L63">                this.buffer = ioIn.read();</span>
             //   System.out.println(&quot;read byte:&quot;+buffer);
<span class="fc bfc" id="L65" title="All 2 branches covered.">                if(buffer == -1){</span>
<span class="fc" id="L66">                    index = -1;</span>
<span class="fc" id="L67">                    buffer= 0;        </span>
                }else{
<span class="fc" id="L69">                index = 8;</span>
<span class="fc" id="L70">                inCounter++;</span>
                }
<span class="nc" id="L72">            }catch(Exception e){</span>
<span class="nc" id="L73">                System.out.println(&quot;EOF: &quot;+e.getLocalizedMessage());</span>
<span class="nc" id="L74">                index = -1;</span>
<span class="fc" id="L75">            }</span>
        }
        
<span class="fc" id="L78">    }</span>
    public boolean readBit(){ 
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);</span>
       
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">        if(inEmpty()) throw new NoSuchElementException(&quot;Eof at: &quot;+inCounter);</span>
        
<span class="fc" id="L84">        index --;</span>
   
        
<span class="fc bfc" id="L87" title="All 2 branches covered.">        boolean value = ((buffer &gt;&gt; index)&amp; 1)==1;</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">        if(index &lt;= 0) {</span>
<span class="fc" id="L89">            index = 0;</span>
<span class="fc" id="L90">            buffer = 0;</span>
<span class="fc" id="L91">            fillInBuffer();</span>
        }
<span class="fc" id="L93">        return value;</span>
        
      
    }
    public char readChar(){
       
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);</span>
<span class="fc" id="L100">        int data = 0;</span>
      
<span class="fc bfc" id="L102" title="All 2 branches covered.">        if(index == 8){</span>
      
<span class="fc" id="L104">            data = buffer;</span>
<span class="fc" id="L105">            index = 0;</span>
<span class="fc" id="L106">            buffer = 0;</span>
<span class="fc" id="L107">            fillInBuffer();</span>
          //  System.out.println(&quot;returning char: &quot;+data);
<span class="fc" id="L109">            return (char)(data &amp; 0xff);</span>
        }else{
<span class="fc" id="L111">            data = buffer;</span>
<span class="fc" id="L112">            int localIndex = index;</span>
<span class="fc" id="L113">            buffer = 0;</span>
<span class="fc" id="L114">            index = 0;</span>
<span class="fc" id="L115">            fillInBuffer();</span>
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">            if(inEmpty()) throw new NoSuchElementException(&quot;Eof&quot;);</span>
          //  System.out.println(&quot;moving : &quot; +(8-localIndex)+&quot; bits&quot;);
<span class="fc" id="L118">            data &lt;&lt;= (8-localIndex);</span>
<span class="fc" id="L119">            index = localIndex;</span>
<span class="fc" id="L120">            data |= (buffer &gt;&gt;&gt; index);</span>
           //   System.out.println(&quot;returning char: &quot;+data);
<span class="fc" id="L122">            return (char)(data &amp; 0xff) ;</span>
            
            
            
            
        }
        
        
        
    }
    public int readByteAsInt(){
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);</span>
<span class="fc" id="L134">        int data = 0;</span>
      
<span class="fc bfc" id="L136" title="All 2 branches covered.">        if(index == 8){</span>
      
<span class="fc" id="L138">            data = buffer;</span>
<span class="fc" id="L139">            index = 0;</span>
<span class="fc" id="L140">            buffer = 0;</span>
<span class="fc" id="L141">            fillInBuffer();</span>
<span class="fc" id="L142">            return data;</span>
        }else{
<span class="fc" id="L144">            data = buffer;</span>
<span class="fc" id="L145">            int localIndex = index;</span>
<span class="fc" id="L146">            buffer = 0;</span>
<span class="fc" id="L147">            index = 0;</span>
<span class="fc" id="L148">            fillInBuffer();</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">            if(inEmpty()) throw new NoSuchElementException(&quot;Eof&quot;);</span>
<span class="fc" id="L150">            data &lt;&lt;= (8-localIndex);</span>
<span class="fc" id="L151">            index = localIndex;</span>
<span class="fc" id="L152">            data |= (buffer &gt;&gt;&gt; index);</span>
<span class="fc" id="L153">            return data%256;</span>
            
            
            
            
        }
      
        
    }
    public int getInCounter(){
<span class="nc" id="L163">        return this.inCounter;</span>
    }
    public int getOutCounter(){
<span class="fc" id="L166">        return this.outCounter;</span>
    }
    private void writeOutput(){
        try{
<span class="fc" id="L170">            ioOut.write(outBuffer);</span>
        
          //  System.out.println(&quot;wrote byte: &quot;+outBuffer);
<span class="fc" id="L173">            outBuffer = 0;</span>
<span class="fc" id="L174">            outIndex = 0;</span>
<span class="fc" id="L175">            outCounter++;</span>
            
<span class="nc" id="L177">        }catch(IOException e){</span>
<span class="nc" id="L178">            System.out.println(&quot;Exception in writing to file: &quot;+e.getLocalizedMessage() );</span>
<span class="fc" id="L179">        }</span>
<span class="fc" id="L180">    }</span>
    public void writeBoolean(boolean bit){
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);</span>
<span class="fc" id="L183">        outBuffer &lt;&lt;= 1; //add one bit to right</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">        if(bit) outBuffer |= 1;</span>
         //System.out.println(&quot;wrote out: &quot;+bit);
<span class="fc" id="L186">        outIndex++;</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">        if(outIndex &gt;= 8) writeOutput();</span>
<span class="fc" id="L188">    }</span>
    public void writeByte(int value){
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);    </span>
<span class="fc bfc" id="L191" title="All 2 branches covered.">        if(outIndex == 0){</span>
           // System.out.println(&quot;writing a full byte&quot;);
<span class="fc" id="L193">            outBuffer = value;</span>
<span class="fc" id="L194">            outIndex = 8;</span>
<span class="fc" id="L195">            writeOutput();</span>
        }else{
          //  System.out.println(&quot;writing byte bit by bit&quot;);
<span class="fc bfc" id="L198" title="All 2 branches covered.">              for (int i = 0; i &lt; 8; i++) {</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">            boolean bit = ((value &gt;&gt;&gt; (8 - i - 1)) &amp; 1) == 1;</span>
<span class="fc" id="L200">            writeBoolean(bit);</span>
                 
        }
//            for(int i = 7; i&lt;=0;i--){
//                System.out.println(&quot;adding individual bits: &quot;+i);
//                 if(value &lt;&lt; ~i&lt;0){
//                     writeBoolean(true);
//                     System.out.println(&quot;true&quot;);
//                 }else{
//                     writeBoolean(false);
//                     System.out.println(&quot;false&quot;);
//                 }
//            }
        }
<span class="fc" id="L214">    }</span>
    /**
     * Writes integer with the predefined length as bits out.
     * Will throw exception if the length is larger than max int length 32
     * @param value the value to be written
     * @param length the amount of bits to be used
     */
    public void writeInt(int value, int length){
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">        if(length == 32 ){</span>
<span class="nc" id="L223">            writeInt(value);</span>
        }
<span class="pc bpc" id="L225" title="2 of 4 branches missed.">        if(length &lt; 1 || length &gt; 32) throw new IllegalStateException(&quot;illegal int length&quot;);</span>
<span class="fc bfc" id="L226" title="All 2 branches covered.">        for(int i = 0; i&lt;length;i++){</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">               boolean bit = ((value &gt;&gt;&gt; (length - i - 1)) &amp; 1) == 1;</span>
<span class="fc" id="L228">               writeBoolean(bit);</span>
        }
<span class="fc" id="L230">    }</span>
    public int readInt(int length){
<span class="pc bpc" id="L232" title="1 of 2 branches missed.">        if(length == 32) return readInt();</span>
<span class="pc bpc" id="L233" title="2 of 4 branches missed.">        if(length &lt; 1 || length &gt; 32) throw new IllegalStateException(&quot;illegal int length&quot;);</span>
<span class="fc" id="L234">        int result = 0;</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">        for(int i = 0; i&lt; length;i++){</span>
<span class="fc" id="L236">            boolean bit = readBit();</span>
<span class="fc" id="L237">            result &lt;&lt;= 1;</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">            if(bit){</span>
<span class="fc" id="L239">                result |= 1;</span>
            }
        }
        
        
<span class="fc" id="L244">        return result;</span>
    }
    public void writeInt(int value){
<span class="fc" id="L247">        byte[] b = ByteBuffer.allocate(4).putInt(value).array();</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">        for(int i = 0; i&lt;4;i++){</span>
<span class="fc" id="L249">            writeByte(b[i]);</span>
        }
        
<span class="fc" id="L252">    }</span>
    /**
     * Reads 4 bytes from disk and returns it as integer
     * @return integer value of 4 next bytes
     */
    public int readInt(){
<span class="fc" id="L258">        byte[] b = new byte[4];</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">        for(int i = 0; i&lt;4;i++){</span>
<span class="fc" id="L260">            int x = readByteAsInt();</span>
<span class="fc" id="L261">            b[i] =(byte) (x &amp; 0xff);</span>
        }
<span class="fc" id="L263">        return ByteBuffer.wrap(b).getInt();</span>
        
    }
    public void close(){
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">        if(!active) throw new IllegalStateException(&quot;No active input/output streams&quot;);</span>
<span class="fc" id="L268">        this.active = false;</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">        if(outIndex&gt;0){</span>
<span class="fc" id="L270">            outBuffer &lt;&lt;= (8-outIndex); // pad last byte with zeroes to end.</span>
<span class="fc" id="L271">            writeOutput();</span>
        }
        try{
<span class="fc" id="L274">            ioOut.flush();</span>
<span class="fc" id="L275">            ioIn.close();</span>
<span class="fc" id="L276">            ioOut.close();</span>
<span class="nc" id="L277">        }catch(IOException e){</span>
<span class="nc" id="L278">            System.out.println(&quot;Exception in closing file inteface: &quot;+e.getLocalizedMessage());</span>
<span class="fc" id="L279">        }</span>
<span class="fc" id="L280">    }  </span>
    
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>